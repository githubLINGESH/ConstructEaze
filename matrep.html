<!DOCTYPE html>
<html lang="en">
<head>
  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Sora:wght@400;700&display=swap"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="assets/css/pent.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid" style="margin: 10px 20px;">
          <a class="navbar-brand" href="#">
            <img src="assets/img/logo.png" alt="Construct Eaze" style="width: 280px;">
          </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0"  style="margin-left: 15%;">
              
              <li class="nav-item">
                <a class="nav-link" href="masnode.html">Master</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="conts.html">Labour Management</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="prod.html">Purchase Management</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="todo.html">Site Activity</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" href="labrep.html">Report Generation</a>
              </li>
            </ul>
            <form class="d-flex" action="/login/logout" method="GET">
              <button class="btn" type="submit"><span class="txt">Logout</span></button>
            </form>
          </div>
        </div>
      </nav>

      <div class="row content" style="display: flex; width: 100%; height: 100%;" >
        <div class="col-lg-2">
          <div class="sidebar" style="height: 100%;">
            <nav class="nav flex-column" style="padding-top: 100px; ">
              <a class="nav-link active space" href="labrep.html">Labour Wise Report</a>
              <a class="nav-link space"  href="venrep.html">Vendor Wise Report</a>
              <a class="nav-link space" href="payrep.html">Payment Details Report</a>
              <a class="nav-link space" href="totrep.html">Total Expenses Report</a>
              <a class="nav-link space" style="color: white !important; background-color: rgba(0, 0, 0, 0.2); border-left: 3px solid #F2D200;" href="#">Material Wise Report</a>
              <a class="nav-link space" href="daterep.html">Date Wise Report</a>
              <a class="nav-link space" href="accst.html" >Account Statement</a>
            </nav>
          </div>
        </div>
        <div class="col-lg-10">



            <div class="content-item rep" id="labore-wise">
          
                <div class="report-section" id="labour-report">
                  <h3>MATERIAL WISE REPORT</h3>

                  <div class="filter" style="display: flex; align-items: center;">
                    <div id="filterOptions" class="filter-options" style="margin: 20px;">
                        <label for="filterType">Select Filter:</label>
                        <select id="filterType" onchange="updateButton()">
                          <option value="" disabled selected>Select</option>
                          <option value="product">product</option>
                          
                      </select>
                    </div>
                      <div>
                        <button style="width: 110%; margin:40px;" class="btn-block dropdown-toggle" id="optdrop" role="button"
                        data-bs-toggle="dropdown" aria-expanded="false">Select a Type</button>
                        
                        <ul style="padding: 5px; border-radius: 10px;" id="myDropdown" class="dropdown-menu" aria-labelledby="optdrop">
                        <input style="margin-left: 10px; width: 90%; margin-bottom:10px ;" id="items" type="text" placeholder="Search" onkeyup="filterFunction()">
                      </ul>
                  </div>
                </div>

                  <div style="margin-top: 3.2%;">Start Date:</div>
                  <input type="date" id="startdate">
                  <br><br>
                  <div>End Date:</div>
                  <input type="date" id="enddate">
                  <br><br>
                  <!--<button onclick="storeDates()">Confirm</button>
                  <button onclick="downloadExcel()">Download as Excel</button>-->

                  <form>
                    <input type="hidden" name="report_type" value="labour">
                    <div><button onclick="storeDates()" type="button" style="background-color: #242e82 !important; width:200px;">Download as PDF</button></div>
                    <div><button onclick="downloadExcel()" type="button"  style="background-color: #242e82 !important;width:200px; ">Download as Excel</button></div>
                    <!--<button onclick="generatePDF()">Confirm</button>-->
                </form>
                  <!-- <div class = img >
                  <img src="assets/img/report1.png" alt="Labour Image" width="100">
                  </div> -->
              </div>
              
              </div>

                <script>

                  function filterFunction() {
                    var input, filter, ul, li, a, i;
                    input = document.getElementById("items");
                    filter = input.value.toUpperCase();
                    div = document.getElementById("myDropdown");
                    a = div.getElementsByTagName("li");
                    for (i = 0; i < a.length; i++) {
                        txtValue = a[i].textContent || a[i].innerText;
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        a[i].style.display = "block";
                        } else {
                        a[i].style.display = "none";
                        }
                    }
                    }

                  function populateDropdown() {
                    const dropdown = document.getElementById("myDropdown");
                    const filterType = document.getElementById("filterType").value; // Get the selected filter type
                  
                    // Preserve the search input element
                    const searchInput = document.getElementById("items");
                    dropdown.innerHTML = ""; // Clear existing list items only, not the search input.
                    dropdown.appendChild(searchInput);
                  
                    // Fetch names from the server based on the selected filter type (vendor or product).
                    fetch(`/acc/get-${filterType}-names`) // Update the route as needed
                      .then(response => response.json())
                      .then(names => {
                        names.forEach((name) => {
                          const listItem = document.createElement("li");
                          listItem.textContent = name;
                          listItem.onclick = () => {
                            updateDropdown(name);
                          };
                          dropdown.appendChild(listItem);
                        });
                      })
                      .catch(error => {
                        console.error(`Error fetching ${filterType} names:`, error);
                      });
                  }
                  
                  function updateDropdown(name) {
                    const optdrop = document.getElementById("optdrop");
                    optdrop.textContent = selectedName;
                    selectedName = name;
                  
                    updateDropdown(name);
                  
                  }
                  
                  const filterType = document.getElementById("filterType");
                  filterType.addEventListener("change", function () {
                    // Populate the dropdown with names based on the selected filter type.
                    populateDropdown();
                  });
                  
                  // Initial population of the dropdown.
                  populateDropdown();

                  let selectedProduct = "";

                  function storeDates() {
                      // Get the values of the "Start Date" and "End Date" inputs by their id names
                      const startDateValue = document.getElementById('startdate').value;
                      const endDateValue = document.getElementById('enddate').value;
              
                      // Parse the start and end date strings to Date objects
                      const startDate = new Date(startDateValue);
                      const endDate = new Date(endDateValue);
              
                      // Create an array to store the dates between the start and end dates
                      const dateArray = [];
              
                      // Loop through the dates and add them to the array
                      let currentDate = new Date(startDate);
                      currentDate.setDate(currentDate.getDate() + 1); // Skip the start date
                      while (currentDate < endDate) {
                          dateArray.push(currentDate.toISOString().split('T')[0]);
                          currentDate.setDate(currentDate.getDate() + 1);
                      }
              
                      // Create a form element dynamically to trigger the download
                      const form = document.createElement('form');
                      form.action = '/mato/matdownload-pdf/:productName'; // Set the URL for PDF download
                      form.method = 'POST';
              
                      // Create an input field for dateArray
                      const input = document.createElement('input');
                      input.type = 'hidden';
                      input.name = 'dateArray';
                      input.value = JSON.stringify(dateArray); // Convert dateArray to JSON string
              
                      // Add the input field to the form
                      form.appendChild(input);
              
                      // Add the form to the document and submit it to trigger the download
                      document.body.appendChild(form);
                      form.submit();
              
                      console.log('Dates Between Start and End Date:', dateArray);
                  }

  function downloadExcel() {
    // Get the values of the "Start Date" and "End Date" inputs by their id names
    const startDateValue = document.getElementById('startdate').value;
    const endDateValue = document.getElementById('enddate').value;

    // Parse the start and end date strings to Date objects
    const startDate = new Date(startDateValue);
    const endDate = new Date(endDateValue);

    // Create an array to store the dates between the start and end dates
    const dateArray = [];

    // Loop through the dates and add them to the array
    let currentDate = new Date(startDate);
    currentDate.setDate(currentDate.getDate() + 1); // Skip the start date
    while (currentDate < endDate) {
        dateArray.push(currentDate.toISOString().split('T')[0]);
        currentDate.setDate(currentDate.getDate() + 1);
    }

    // Create a form element dynamically to trigger the download
    const form = document.createElement('form');
    form.action = '/mato/matdownload-excel/:productName'; // Set the URL for PDF download
    form.method = 'POST';

    // Create an input field for dateArray
    const input = document.createElement('input');
    input.type = 'hidden';
    input.name = 'dateArray';
    input.value = JSON.stringify(dateArray); // Convert dateArray to JSON string

    // Add the input field to the form
    form.appendChild(input);

    // Add the form to the document and submit it to trigger the download
    document.body.appendChild(form);
    form.submit();

    console.log('Dates Between Start and End Date:', dateArray);
  }
</script>
              
          
        </div>


      </div>
      
</body>
</html>


